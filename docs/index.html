<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SPC for COVID-10</title>
<link rel="stylesheet" href="spc.css" type="text/css"></link>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="spc.js" type="text/javascript"></script>
</head>
<body>
	<div id="metaContainer">
		<div id="leftContainer">
			<div class="leftItem title">
				<p>COVID-19 Statistical Process Control Charts</p>
				<div><span>State: </span><select id="state" name="state" onchange='loadData(this.value, label)'>>
					<option value="https://covidtracking.com/api/us/daily.csv">All</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=AL">Alabama</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=AK">Alaska</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=AZ">Arizona</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=AR">Arkansas</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=CA">California</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=CO">Colorado</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=CT">Connecticut</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=DE">Delaware</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=DC">District of Columbia</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=FL">Florida</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=GA">Georgia</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=HA">Hawaii</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=ID">Idaho</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=IL">Illinois</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=IN">Indiana</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=IO">Iowa</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=KS">Kansas</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=KY">Kentucky</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=LA">Louisiana</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=MN">Maine</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=MD">Maryland</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=MA">Massachusetts</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=MI">Michigan</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=MN">Minnesota</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=MS">Mississippi</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=MO">Missouri</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=MN">Montana</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=NE">Nebraska</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=NV">Nevada</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=NH">New Hampshire</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=NJ">New Jersey</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=NM">New Mexico</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=NY">New York</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=NC">North Carolina</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=ND">North Dakota</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=OH">Ohio</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=OK">Oklahoma</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=OR">Oregon</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=PA">Pennsylvania</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=RI">Rhode Island</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=SC">South Carolina</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=SD">South Dakota</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=TN">Tennessee</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=TX">Texas</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=UT">Utah</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=VT">Vermont</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=VA">Virginia</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=WA">Washington</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=WV">West Virginia</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=WI">Wisconsin</option>
					<option value="https://covidtracking.com/api/states/daily.csv?state=WY">Wyoming</option>
				</select>
				</div>
			</div>
			<div class="leftItem">
				Data comes from <a href="https://covidtracking.com">covidtracking.com</a>
				using the <a href="https://covidtracking.com/api/">API.</a><br />
				See the <a href="about.html">about</a> page for credits.
			</div>
			<div class="leftItem" id="myLabel">US COVID-19 1/(1 -
				New/Total)</div>
		</div>
		<div id="spcLegend"></div>
	</div>
	<div id="spcContainer">
		<h2>Case Details</h2>
		<h3>Total Cases (Positive Tests)</h3>
		<div id="caseContainer"></div>

		<h3>Hospitalized Patients</h3>
		<div id="hospContainer"></div>

		<h3>Deaths</h3>
		<div id="diedContainer"></div>

		<h2>Testing Detail</h2>
		<h3>Positive Tests (Patients with COVID-19)</h3>
		<div id="posContainer"></div>

		<h3>Negative Tests</h3>
		<div id="negContainer"></div>

		<h3>Positive / Negative Ratio</h3>
		<div id="ratioContainer"></div>
		<h3>Total Results</h3>
		<div id="bothContainer"></div>

		<h3>Pending Tests</h3>
		<div id="pendContainer"></div>

		<h3>Total Tests</h3>
		<div id="totContainer"></div>
	</div>

	<script type="text/javascript">
  var pos = [], neg = [], both = [], pend = [], hosp = [], died = [], tot = [], ratio = [];
  function loadData(myData, label) {
	d3.csv(myData, function(error, d) {
		pos = [], neg = [], both = [], pend = [], hosp = [], died = [], tot = [], ratio = [];
        if (error) throw error;

        data = d;
        data.forEach(function(d) {
          r = new Object();
          r.Date = spc.parseTime("%Y%m%d")(d.date);
          r.pos = 1.0 / (1.0 - (+d.positiveIncrease / +d.positive));
          r.neg = 1.0 / (1.0 - (+d.negativeIncrease / +d.negative));
          r.ratio = +d.positiveIncrease / +d.negativeIncrease;
          r.both = 1.0 / (1.0 - ((+d.positiveIncrease + +d.negativeIncrease) / +d.posNeg));
          r.pend = 1.0 / (1.0 - ((+d.totalTestResultsIncrease - +d.positiveIncrease + +d.negativeIncrease) / +d.pending));
          r.hosp = 1.0 / (1.0 - (+d.hospitalizedIncrease / +d.hospitalized));
          r.died = 1.0 / (1.0 - (+d.deathIncrease / +d.death));
          r.tot = 1.0 / (1.0 - (+d.totalTestResultsIncrease / +d.total));
          if (!isNaN(r.pos) && isFinite(r.pos)) { pos.push(Object.assign({}, r)); }
          if (!isNaN(r.neg) && isFinite(r.neg)) { neg.push(Object.assign({}, r)); }
          if (!isNaN(r.ratio) && isFinite(r.ratio)) { neg.push(Object.assign({}, r)); }
          if (!isNaN(r.both) && isFinite(r.both)) { both.push(Object.assign({}, r)); }
          if (!isNaN(r.pend) && isFinite(r.pend)) { pend.push(Object.assign({}, r)); }
          if (!isNaN(r.hosp) && isFinite(r.hosp)) { hosp.push(Object.assign({}, r)); }
          if (!isNaN(r.died) && isFinite(r.died)) { died.push(Object.assign({}, r)); }
          if (!isNaN(r.tot) && isFinite(r.tot)) { tot.push(Object.assign({}, r)); }
        });
        spc.displayChart(pos, "#posContainer", properties = posProperties = {"autoDetectProcess" : autoDetectProcesses, "yData" : "pos"});
        spc.displayChart(pos, "#caseContainer", posProperties);
        spc.displayChart(neg, "#negContainer", properties = negProperties = {"autoDetectProcess" : autoDetectProcesses, "yData" : "neg"});
        spc.displayChart(neg, "#ratioContainer", properties = ratioProperties = {"autoDetectProcess" : autoDetectProcesses, "yData" : "ratio"});
        spc.displayChart(both, "#bothContainer", properties = bothProperties = {"autoDetectProcess" : autoDetectProcesses, "yData" : "both"});
        spc.displayChart(pend, "#pendContainer", properties = pendProperties = {"autoDetectProcess" : autoDetectProcesses, "yData" : "pend"});
        spc.displayChart(hosp, "#hospContainer", properties = hospProperties = {"autoDetectProcess" : autoDetectProcesses, "yData" : "hosp"});
        spc.displayChart(died, "#diedContainer", properties = diedProperties = {"autoDetectProcess" : autoDetectProcesses, "yData" : "died"});
        spc.displayChart(tot, "#totContainer", properties = totProperties = {"autoDetectProcess" : autoDetectProcesses, "yData" : "tot"});
      });
  }

  var dataFile = "https://covidtracking.com/api/us/daily.csv";
  var state = "";
  var label = "US COVID-19 1/(1 - New Cases/Cases)"
  var properties, posProperties, negProperties, ratioProperaties, bothProperties, pendProperties, hospProperties, diedProperties, totProperties;
  var autoDetectProcesses = false;
  var data

  window.onload = function() {
	  var source = dataFile;
	  loadData(dataFile, "", label);
      spc.drawLegend("#spcLegend");
  }

  toggleAutoDetect = function () {
	properties.autoDetectProcess = !properties.autoDetectProcess;
    spc.displayChart(pos, "#posContainer", properties = posProperties = {"autoDetectProcess" : autoDetectProcesses, "yData" : "pos"});
    spc.displayChart(pos, "#caseContainer", posProperties);
    spc.displayChart(neg, "#negContainer", properties = negProperties = {"autoDetectProcess" : autoDetectProcesses, "yData" : "neg"});
    spc.displayChart(neg, "#ratioContainer", properties = ratioProperties = {"autoDetectProcess" : autoDetectProcesses, "yData" : "ratio"});
    spc.displayChart(both, "#bothContainer", properties = bothProperties = {"autoDetectProcess" : autoDetectProcesses, "yData" : "both"});
    spc.displayChart(pend, "#pendContainer", properties = pendProperties = {"autoDetectProcess" : autoDetectProcesses, "yData" : "pend"});
    spc.displayChart(hosp, "#hospContainer", properties = hospProperties = {"autoDetectProcess" : autoDetectProcesses, "yData" : "hosp"});
    spc.displayChart(died, "#diedContainer", properties = diedProperties = {"autoDetectProcess" : autoDetectProcesses, "yData" : "died"});
    spc.displayChart(tot, "#totContainer", properties = totProperties = {"autoDetectProcess" : autoDetectProcesses, "yData" : "tot"});
  }

  window.onresize = function() {
	    spc.resizeChart("#posContainer", properties = posProperties = {"autoDetectProcess" : autoDetectProcesses, "yData" : "pos"});
        spc.resizeChart("#caseContainer", properties = posProperties);
	    spc.resizeChart("#negContainer", properties = negProperties = {"autoDetectProcess" : autoDetectProcesses, "yData" : "neg"});
	    spc.resizeChart("#ratioContainer", properties = ratioProperties = {"autoDetectProcess" : autoDetectProcesses, "yData" : "ratio"});
	    spc.resizeChart("#bothContainer", properties = bothProperties = {"autoDetectProcess" : autoDetectProcesses, "yData" : "both"});
	    spc.resizeChart("#pendContainer", properties = pendProperties = {"autoDetectProcess" : autoDetectProcesses, "yData" : "pend"});
	    spc.resizeChart("#hospContainer", properties = hospProperties = {"autoDetectProcess" : autoDetectProcesses, "yData" : "hosp"});
	    spc.resizeChart("#diedContainer", properties = diedProperties = {"autoDetectProcess" : autoDetectProcesses, "yData" : "died"});
	    spc.resizeChart("#totContainer", properties = totProperties = {"autoDetectProcess" : autoDetectProcesses, "yData" : "tot"});
  }
  </script>
</body>
</html>
